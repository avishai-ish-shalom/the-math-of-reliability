<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>The Math of Reliability at Scale</title>

        <meta name="description" content="">
        <meta name="author" content="Avishai Ish-Shalom">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="http://public.fewbytes.com/reveal.js/3.1.0/css/reveal.min.css">
        <link rel="stylesheet" href="http://public.fewbytes.com/reveal.js/3.1.0/css/theme/league.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="http://public.fewbytes.com/reveal.js/3.1.0/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'http://public.fewbytes.com/reveal.js/3.1.0/css/print/pdf.css' : 'http://public.fewbytes.com/reveal.js/3.1.0/css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );

        var m = window.location.search.match(/theme=([^&]+)/);
        if( m ) {
            theme = m[1]; 
            var link = document.getElementById('theme');
            link.href = 'http://public.fewbytes.com/reveal.js/3.1.0/css/theme/' + theme + '.css';
        }
    </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <h1 style="font-size: 120px;">The Math of Reliability at Scale</h1>
                    <p>Avishai Ish-Shalom (@nukemberg)</p>
                    <p>
                        <b>Notebook URL:</b> <a href="https://github.com/avishai-ish-shalom/the-math-of-reliability/blob/master/reliability.ipynb">http://fewbytes.com/reliability-notebook</a>
                    </p>
                </section>
                <section>
                    <h2>Math!?</h2>
                    <img src="images/run-away.gif" alt="">
                </section>
                <section>
                    <h2>Excercise: Nagios alerts</h2>
                    <div>
                        <p>Nagios service with <i>max_check_attempts=4</i>, <i>check_interval</i>=15sec</p>
                        <p>Service experiencing 40% error rate</p>
                    </div>
                    <div style="margin-top: 2em;">
                        <p>Chance of hard CRITICAL: <span style="color: red;">2.6%</span></p>
                        <p>Chance of NOT GETTING ANY ALERT:</p>
                        <table>
                            <tr><td>0.5 hour</td><td>45.9%</td></tr>
                            <tr>
                                <td>1 hour</td>
                                <td>21.1%</td>
                            </tr>
                            <tr>
                                <td>1.5 hours</td>
                                <td>9.9%</td>
                            </tr>
                        </table>
                    </div>
                </section>
                <section>
                    <section>
                        <h1>Define "Reliable"</h1>
                        <div class="fragment">
                            <ul>
                                <li>"4 nines"</li>
                                <li>MTBF</li>
                                <li>Failures per Year</li>
                                <li>QoS</li>
                                <li>SLA</li>
                            </ul>
                            <aside class="notes">
                                <ul>
                                    <li>Lots of buzzwords, all insufficient</li>
                                    <li>Need to define what is failure</li>
                                </ul>
                            </aside>
                        </div>
                    </section>
                    <section>
                        <h2>Define "Failure"</h2>
                        <h3 class="fragment">Not working within specified parameters</h3>
                        <h3 class="fragment">In reality: users are complaining!</h3>
                    </section>
                    <section>
                        <h2>"Failure" is subjective!</h2>
                    </section>
                    <section>
                        <h2>Possible states</h2>
                        <ul class="fragment">
                            <li>Working OK</li>
                            <li>Failure</li>
                            <li class="fragment">Fuzzy</li>
                            <li class="fragment">Don't know</li>
                        </ul>

                        <aside class="notes">
                            <ul>
                                <li>Failure - operating outside parameters</li>
                                <li>Failure isn't allways obvious</li>
                                <li>which clock is "correct"? which value?</li>
                                <li>We don't always know what "correct" is</li>
                            </ul>
                        </aside>
                    </section>
                    <section>
                        <h3>1st law of monitoring:</h3>
                        <h2>The absence of alerts does not indicate success</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Let's talk about failure</h2>
                        <img src="images/cat-failure.gif" alt="">
                    </section>
                    <section>
                        <h1>Statistical independence</h1>
                    </section>
                    <section>
                        <h2>The Hot Hand fallacy</h2>
                    </section>
                    <section>
                        <h2>The Gambler's fallacy</h2>
                    </section>
                    <section>
                        <h2>Past performance does not dictate future performance*</h2>
                    </section>
                    <section>
                        <h2>Reliability measures</h2>
                        <ul>
                            <li>MTBF = mean time between failures (years per failure)</li>
                            <li>&lambda; = failures per year</li>
                            <li>F = failure rate or probability of failure in year</li>
                            <li>R = reliability rate (probability of working in year)</li>
                        </ul>
                        <p>$$\lambda = T / MTFB$$</p>
                        <p>$$F = \lambda / T = 1 / MTBF$$</p>
                        <p>$$R = 1 - F$$</p>
                        <aside class="notes">
                            <p>typical hdd MTBF - 1M hours (about 130 years); MTBF computed in a lab and extrapolated over time</p>
                        </aside>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Serial reliability</h2>
                        <h4>$$R_{total} = \prod_{i=0}^{n} R_{i}$$</h4>
                        <!-- <p>$$\lambda_{total} = \sum_{i=0}^{n} \lambda_{i}$$</p> -->
                    </section>
                    <section>
                        <h2>Serial reliability</h2>
                        <table>
                            <thead>
                                <th>R1</th>
                                <th>R2</th>
                                <th>R3</th>
                                <th>R system</th>
                                <th>Improvement (MTBF)</th>
                            </thead>
                            <tr>
                                <td>0.95</td>
                                <td>0.99</td>
                                <td>0.995</td>
                                <td>0.936</td>
                                <td>-</td>
                            </tr>
                            <tr class="fragment">
                                <td>0.95</td>
                                <td>0.99</td>
                                <td><b>0.9995</b></td>
                                <td>0.94</td>
                                <td>X 1.07</td>
                            </tr>
                            <tr class="fragment">
                                <td>0.95</td>
                                <td><b>0.999</b></td>
                                <td>0.995</td>
                                <td>0.944</td>
                                <td>X 1.15</td>
                            </tr>
                            <tr class="fragment">
                                <td><b>0.995</b></td>
                                <td>0.99</td>
                                <td>0.995</td>
                                <td>0.98</td>
                                <td>X 3.21</td>
                            </tr>
                        </table>
                        <div class="fragment">
                            <p style="align: center;">$$R_{total} \lt min(R_{i})$$</p>
                            <p>Best ROI - improve the <b>worst</b> component</p>
                        </div>
                    </section>
                    <section>
                        <h2>Parallel reliability (redundancy)</h2>
                        <p>Reliability of redundant system, up to $k$ failures</p>
                        <p>$$R_{total}(n, k) = \sum_{i=0}^{k} {n \choose i} F^{i} R^{n-i}$$</p>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Reliability improvement

                            Redundant system, 10 components, upto 2 failures

                            |R|MTBF|Total R|Total MTBF|improvement factor|
                            |-|-|-|-|-|
                            |0.95|19|0.9885|86|4.5x|
                            |0.99|99|0.9999|8783|88.7x|

                            Higher ROI with more reliable components
                        </script>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Correlated failures</h2>
                        <ul>
                            <li>Shared workload</li>
                            <li>Shared code</li>
                            <li>Shared infrastracture</li>
                        </ul>
                    </section>
                    <section>
                        <p>The police have breathalyzers displaying false drunkenness in 5% of the cases in which the driver is sober. However, the breathalyzers never fail to detect a truly drunk person. One in a thousand drivers are driving drunk</p>
                        <p>A driver is stopped at random and the breathalyzer shows "drunk" result. We assume you don't know anything else about him/her. What is the probability he/she really is drunk?<p>
                    </section>
                    <section>
                        <p>If you answered 0.95, you are prone to the</p>
                        <h2>The Base rate fallacy</h2>
                        <p>Correct anser: ~ 0.02</p>
                    </section>
                    <section>
                        <h3>Explanation</h3>
                        <p>The base rate is 1:1000 (drunks to general population), so for every 1 drunk detected the breathalyzer will detect 50 sober people as drunk, so given a "drunk" test result there's a 50:1 chance of false positive result</p>
                        <p>Bayes theorem: $P(A|B) = P(B|A) P(A)/P(B)$</p>
                    </section>
                    <section>
                        <h2>Active/Standby failover</h2>
                        <ul>
                            <li>Failed master detected always</li>
                            <li>2% probability of false positive (ok master detected as failed)</li>
                            <li>~ 95% of failovers are erroneous</li>
                            <li>Erroneous failovers can cause severe issues</li>
                        </ul>
                        <h3 class="fragment">Disable auto failover, reduce false positives or use active/active</h3>
                        <aside class="notes">
                            <ul>
                                <li>Database failover dillema, github 2012 outage</li>
                            </ul>
                        </aside>
                    </section>
                </section>
                <section>
                    <section>
                        <h1>Complex Adaptive Systems</h1>
                    </section>
                    <section>
                        <h2>Phase changes</h2>
                        <img src="images/instant-freezing-water.gif" alt="">
                    </section>
                    <section>
                        <h2>Chain Reaction</h2>
                        <img src="images/chain-reaction-ping-pong.gif" alt="">
                    </section>
                    <section>
                        <h2>Feedback loops</h2>
                    </section>
                    <section>
                        <h2>System memory</h2>
                    </section>
                    <section>
                        <h2>Transient -> permanent</h2>
                    </section>
                </section>
                <section>
                    <h2>Thank you</h2>
                    <img src="images/holy-grail-taunt.gif" alt="">
                </section>
            </div>
        </div>

        <script src="http://public.fewbytes.com/reveal.js/3.1.0/lib/js/head.min.js"></script>
        <script src="http://public.fewbytes.com/reveal.js/3.1.0/js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                transition: Reveal.getQueryHash().transition || 'slide', // none/fade/slide/convex/concave/zoom
                math: {
                    mathjax: 'https://cdn.mathjax.org/mathjax/latest/MathJax.js',
                    config: 'TeX-AMS_HTML-full'  // See http://docs.mathjax.org/en/latest/config-files.html
                },
                // Parallax scrolling
                // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
                // parallaxBackgroundSize: '2100px 900px',

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'http://public.fewbytes.com/reveal.js/3.1.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'http://public.fewbytes.com/reveal.js/3.1.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'http://public.fewbytes.com/reveal.js/3.1.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'http://public.fewbytes.com/reveal.js/3.1.0/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'http://public.fewbytes.com/reveal.js/3.1.0/plugin/zoom-js/zoom.js', async: true },
                    { src: 'http://public.fewbytes.com/reveal.js/3.1.0/plugin/notes/notes.js', async: true },
                    { src: 'http://public.fewbytes.com/reveal.js/3.1.0/plugin/math/math.js', async: true}
                ]
            });

        </script>

    </body>
</html>
